#!/bin/bash

set -euo pipefail

PROG=$(basename "$0")

LOGFILE="false"

__DisplayUsage()
{
    cat <<EOF
Usage: $PROG [options]
Options
    all              compile the program
    specs [PATTERN]  run specified tests
    clean            clean directory

EOF
}

__DebugLog()
{
    [[ "$LOGFILE" != "false" ]] \
        && printf "[%s] %s\n" "$(date +'%d-%b-%Y-%H:%M:%S')" "${1}" >> "$LOGFILE" \
        || printf "[%s] %s\n" "$(date +'%d-%b-%Y-%H:%M:%S')" "${1}"
}

__Compile()
{
    make;
}

__Specs()
{
    cat << __EOF__ > specs.mk 
SPECS_SRCS := \$(shell find . -name "spec.${1}.cpp")
__EOF__

    make spec;
}

__Clean()
{
    make fclean;
    rm specs.mk
}

__EntryPoint()
{
    case $1 in
        all )    __Compile ;;
        specs )  __Specs "${2}";;
        clean )  __Clean ;;
        * )      __DisplayUsage ;;
    esac
}

if [[ "$#" -eq 0 ]] ;
    then
        __DisplayUsage
	      exit 1
    else
        __EntryPoint "$@"
fi
